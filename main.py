import json
from Module.AgentCaller import nmapCaller
from Module.kafkaQueue import consumer, mainProducer

def handleNmapConsumer():
    # TODO: Multi thread consumer
    nmapConsumer = consumer.nmapConsumer()

    for message in nmapConsumer:
        data = message.value

        print('{} added to Queue'.format(data))
        jData = {}
        jData['target'] = data['target']
        jData['actions'] = 'fullfullfull'
        jData = json.dumps(jData)
        print(jData)
        result = nmapCaller.callNmapAgent(jData)
        print(result)

def testNmapProducer():
    nmapProducer = mainProducer

    # targets = ['127.0.0.1', 'scanme.nmap.org', 'gooogle.com.vn', 'facebook.com', 'kenh14.vn', 'genk.vn', 'gamek.vn']
    targets = ['127.0.0.1']
    for target in targets:
        data = {'target' : target}
        nmapProducer.sendNmap(data)
        print('produce ', data)


def main():
    testNmapProducer()
    handleNmapConsumer()


if __name__ == "__main__":
    main()